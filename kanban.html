<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- FontAwesome link -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <!-- Bootstrap CSS link -->
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">

    <link rel="stylesheet" href="./kanban.css">
    
    <title>Tasko Application</title>

</head>
<body class="bg-light">
    <section class="container-fluid mt-5 px-md-5">
        <h3 class="font-weight-bold mb-4">CWP Board</h3>
        <div class="row">
            <div class="mt-4 col-lg-3 col-md-5 col-8">
                <div class="search_icon">
                  <i class="fa-solid fa-magnifying-glass"></i>
                  <input type="text" class="form-control" id="searchInput" placeholder="Search">
                </div>
            </div>
            <div class="col-3 d-flex mt-3">
                <div class="d-flex justify-content-center bg-primary rounded-circle align-items-center font-weight-bold text-white member_name1">P</div>
                <div class="d-flex justify-content-center bg-success rounded-circle align-items-center font-weight-bold text-white member_name2">H</div>
            </div>
        </div>
        <div class="row kanban_boxes mt-4 ">

            <div class="col-md-4 mb-4">
                <div class="bg-white p-3 rounded-lg shadow-sm h-100" id="todoList" ondragover="allowDrop(event)" ondrop="drop(event, 'todoList')">
                    <h2 class="h5 font-weight-semibold">To Do</h2>
                </div>
            </div>
            
            <div class="col-md-4 mb-4">
                <div class="bg-white p-3 rounded-lg shadow-sm h-100" id="inProgressList" ondragover="allowDrop(event)" ondrop="drop(event, 'inProgressList')">
                    <h2 class="h5 font-weight-semibold">In Progress  <i class="fa-solid fa-bars-progress ml-2"></i></h2>
                </div>
            </div>
            
            <div class="col-md-4 mb-4">
                <div class="bg-white p-3 rounded-lg shadow-sm h-100" id="doneList" ondragover="allowDrop(event)" ondrop="drop(event, 'doneList')">
                    <h2 class="h5 font-weight-semibold">Done <i class="fa-solid fa-check text-success ml-2"></i></h2>
                </div>
            </div>
        </div>
    </section>

</body>
</html>

<script>
    window.onload = function() {
    const storedTasks = JSON.parse(localStorage.getItem('tasks')) || [];

    if (storedTasks.length > 0) {
        const taskList = document.getElementById('todoList');

        storedTasks.forEach((task, index) => {
            const taskElement = document.createElement('div');
            taskElement.setAttribute('id', `task-${index}`);
            taskElement.setAttribute('draggable', 'true');
            taskElement.classList.add('task-item');
            taskElement.addEventListener('dragstart', dragStart);

            taskElement.innerHTML = `
                <div class="card shadow-sm mb-3">
                    <div class="card-body">
                        <h5 class="card-title text-primary font-weight-bold">${task.taskName}</h5>
                        <p class="card-text">
                            <strong>Description:</strong> ${task.taskDescription}
                        </p>
                        <p class="card-text">
                            <strong>Due Date:</strong> ${task.dueDate}
                        </p>
                        <p class="card-text">
                            <strong>Assigned To:</strong> ${task.assignMember}
                        </p>
                    </div>
                    <div class="card-footer text-right">
                        <button class="btn btn-sm btn-outline-danger delete-btn">Delete</button>
                    </div>
                </div>
            `;

            taskList.appendChild(taskElement);

            const deleteButton = taskElement.querySelector('.delete-btn');
            deleteButton.addEventListener('click', function() {
                taskElement.remove();
                storedTasks.splice(index, 1);
                localStorage.setItem('tasks', JSON.stringify(storedTasks));
            });
        });
    }

    const searchInput = document.getElementById('searchInput');
    searchInput.addEventListener('input', function(event) {
        const searchTerm = event.target.value.toLowerCase();

        document.querySelectorAll('.task-item').forEach(taskElement => {
            const taskName = taskElement.querySelector('.card-title').textContent.toLowerCase();
            const taskDescription = taskElement.querySelector('.card-text').textContent.toLowerCase();

            if (taskName.includes(searchTerm) || taskDescription.includes(searchTerm)) {
                taskElement.style.display = 'block';
            } else {
                taskElement.style.display = 'none';
            }
        });
    });
};

function allowDrop(event) {
    event.preventDefault();
}

function dragStart(event) {
    event.dataTransfer.setData('text', event.target.id);
}

function drop(event, targetListId) {
    event.preventDefault();
    const taskId = event.dataTransfer.getData('text');
    const taskElement = document.getElementById(taskId);
    document.getElementById(targetListId).appendChild(taskElement);
}
</script>
